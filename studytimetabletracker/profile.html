<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Profile â€” Study Time Table Tracker</title>
<link rel="stylesheet" href="style.css"/>
<style>
.profile-card { max-width:500px; margin:2rem auto; text-align:center; }
.avatar-circle { width:90px; height:90px; border-radius:50%; margin:0 auto 1rem; background:var(--accent); display:flex; align-items:center; justify-content:center; font-size:2.5rem; font-weight:700; color:white; }
.profile-name { font-size:1.5rem; font-weight:700; margin-bottom:0.25rem; }
.profile-email { color:var(--text-muted); font-size:0.9rem; margin-bottom:2rem; }
.stat-row { display:grid; grid-template-columns:repeat(3,1fr); gap:1rem; margin-bottom:2rem; }
.stat-box { padding:1rem; border:1px solid var(--border); border-radius:8px; }
.stat-box-value { font-size:1.5rem; font-weight:700; color:var(--accent); font-family:var(--mono); }
.stat-box-label { font-size:0.75rem; color:var(--text-muted); margin-top:0.25rem; }
</style>
</head>
<body>
<nav>
  <a href="index.html" class="nav-brand">Study Time Table <span>Tracker</span></a>
  <div class="nav-links">
    <a href="index.html">Dashboard</a>
    <a href="subjects.html">Subjects</a>
    <a href="profile.html">My Profile</a>
  </div>
</nav>
<div class="page">
  <div class="profile-card card fade-up">
    <div class="avatar-circle" id="avatarCircle">?</div>
    <div class="profile-name" id="profileName">Study User</div>
    <div class="profile-email" id="profileEmail">Not signed in</div>

    <div class="stat-row">
      <div class="stat-box">
        <div class="stat-box-value" id="totalHours">0h</div>
        <div class="stat-box-label">Total Hours</div>
      </div>
      <div class="stat-box">
        <div class="stat-box-value" id="totalSessions">0</div>
        <div class="stat-box-label">Sessions</div>
      </div>
      <div class="stat-box">
        <div class="stat-box-value" id="topicsDone">0</div>
        <div class="stat-box-label">Topics Done</div>
      </div>
    </div>

    <div id="signedInActions" style="display:none">
      <button onclick="signOut()" class="btn btn-danger" style="width:100%">Sign Out</button>
    </div>
    <div id="signedOutActions" style="display:none">
      <a href="login.html" class="btn btn-primary" style="width:100%;display:block">Sign In with Google</a>
    </div>

  </div>
</div>
<script src="app.js"></script>
<script>
async function init() {
  const userId = localStorage.getItem('user_id');
  const name = localStorage.getItem('user_name');
  const email = localStorage.getItem('user_email');

  if (userId && name) {
    document.getElementById('avatarCircle').textContent = name.charAt(0).toUpperCase();
    document.getElementById('profileName').textContent = name;
    document.getElementById('profileEmail').textContent = email || '';
    document.getElementById('signedInActions').style.display = 'block';
    document.getElementById('signedOutActions').style.display = 'none';
  } else {
    document.getElementById('avatarCircle').textContent = '?';
    document.getElementById('profileName').textContent = 'Not signed in';
    document.getElementById('profileEmail').textContent = 'Sign in to sync your progress';
    document.getElementById('signedInActions').style.display = 'none';
    document.getElementById('signedOutActions').style.display = 'block';
  }

  // Stats
  const log = getStudyLog();
  const totalH = log.reduce((s, l) => s + l.hours, 0);
  document.getElementById('totalHours').textContent = totalH.toFixed(1) + 'h';
  document.getElementById('totalSessions').textContent = log.length;

  const DATA = await loadData();
  const completed = getCompleted();
  const done = DATA.subjects.reduce((s, sub) => s + countCompletedSubtopics(sub, completed), 0);
  document.getElementById('topicsDone').textContent = done;
}

function signOut() {
  localStorage.removeItem('user_id');
  localStorage.removeItem('user_email');
  localStorage.removeItem('user_name');
  window.location.href = 'login.html';
}

init();
</script>
</body>
</html>
